---
title: å°ç¨‹åºä½¿ç”¨ç™¾åº¦åœ°å›¾POIæ£€ç´¢æœåŠ¡å’Œè·³è½¬æ‰‹æœºå¯¼èˆª
---

# å°ç¨‹åºä½¿ç”¨ç™¾åº¦åœ°å›¾POIæ£€ç´¢æœåŠ¡å’Œè·³è½¬æ‰‹æœºå¯¼èˆª

##  ç¬¬ä¸€æ­¥ï¼š
  - å…ˆåˆ°ç™¾åº¦å¼€æ”¾å¹³å°ç”³è¯·akï¼šhttp://lbsyun.baidu.com

##  ç¬¬äºŒæ­¥ï¼š
  - å¾®ä¿¡å…¬ä¼—å¹³å°è®¾ç½®è¯·æ±‚åˆæ³•åŸŸå

 ![](/å°ç¨‹åº/è®¾ç½®è¯·æ±‚åˆæ³•åŸŸå.png)

 ##  ç¬¬ä¸‰æ­¥ï¼š
  - ä¸‹è½½ç™¾åº¦åœ°å›¾çš„apiï¼šhttps://lbsyun.baidu.com/index.php?title=wxjsapi/wxjs-download

  - è§£å‹åï¼Œé‡Œé¢æœ‰2ä¸ªjsæ–‡ä»¶ï¼Œä¸€ä¸ªæ˜¯å¸¸è§„æ²¡å‹ç¼©çš„ï¼Œå¦ä¸€ä¸ªæ˜¯å‹ç¼©è¿‡çš„

  - ç”±äºå°ç¨‹åºé¡¹ç›®æ–‡ä»¶å¤§å°é™åˆ¶ä¸º1Mï¼Œå»ºè®®ä½¿ç”¨å‹ç¼©ç‰ˆçš„jsæ–‡ä»¶

##  ç¬¬å››æ­¥ï¼š
  - å¼•å…¥JSæ¨¡å—åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªè·¯å¾„ï¼Œå°†ç™¾åº¦çš„jsæ–‡ä»¶æ‹·è´åˆ°æ–°å»ºçš„è·¯å¾„ä¸‹ï¼Œæ–°å»ºè·¯å¾„ "libs/bmap-wx" ï¼Œå°† bmap-xw.min.js æ–‡ä»¶æ‹·è´è‡³ "libs/bmap-wx" è·¯å¾„ä¸‹

```html
 <map
  class="map"
  id="map"
  longitude="{{longitude}}"
  latitude="{{latitude}}"
  scale="14"
  markers="{{markers}}"
></map>
```

```css
.map {
  height: 100vh;
  weight: 100vw;
}
```


```js
// å¼•ç”¨ç™¾åº¦åœ°å›¾å¾®ä¿¡å°ç¨‹åºJSAPIæ¨¡å—
const bmap = require('./libs/bmap-wx')
let BMap = {}
Page({
  data: {
    markers: [],
    latitude: '',
    longitude: '',
    keywords: ''
  },

  onLoad () {
    this.createMap()
  },

  // è¾“å…¥æœç´¢
  searchValue(e) {
    this.setData({
      keywords: e.detail
    })
  },

  createMap() {
    // æ–°å»ºç™¾åº¦åœ°å›¾å¯¹è±¡
    BMap = new bmap.BMapWX({ak: 'xxxxxxxxxxxxxxxxxxxxxxxxxxxxx'})
    this.search()
  },

  // æœç´¢æŒ‰é’®
  search() {
    const fail = data => {
      console.log(data)
      common.showModalCallBack(data)
    }
    const success = data => {
      console.log('ğŸš€ ~ [data]', data)
      if(!data.originalData.results.length) {
        common.showModalCallBack('é™„è¿‘50å…¬é‡Œå†…æœªæ‰¾åˆ°')
      } else {
        const results = data.originalData.results.map((r, i) => ({
          title: r.name,
          address: r.address,
          id: i,
          mobile: r.telephone,
          detail_info: r.detail_info,
          latitude: r.location.lat,
          longitude: r.location.lng,
          iconPath: 'https://xxxxxxxxxxxxxxxxxxxxxxxxxxx.png'
        }))
        const markers = results.map(marker => ({
          ...marker,
          width: 35,
          height: 45,
          iconPath: 'https://xxxxxxxxxxxxxxxxxxxxxxxxxxxx.png'
        }));
        // const mapCtx = wx.createMapContext('map')
        // mapCtx.setLocMarkerIcon({
        //   iconPath:'https://xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx.png'
        // })
        this.setData({
          markers,
          latitude: results[0].latitude - 0.025,
          longitude: results[0].longitude + 0.01
        });
      }
    }
    // å‘èµ·POIæ£€ç´¢è¯·æ±‚
    BMap.search({
      query: this.data.keywords,
      radius: '50000',
      coord_type: 2,
      center: `${this.data.latitude},${this.data.longitude}`,
      scope: 2,
      filter: 'sort_name:distance|sort_rule:1',
      fail: fail,
      success: success,
    });
  },

  // ç‚¹å‡»åœ°å€ä½¿ç”¨æ‰‹æœºå¯¼èˆª
  navigation(e) {
    const { value } = e.currentTarget.dataset
    wx.openLocation({
      latitude: value.latitude,
      longitude: value.longitude,
      scale: 12,
      name: value.title,
      address: value.address,
    })
  },
})
```