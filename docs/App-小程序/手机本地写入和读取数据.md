---
title: æ‰‹æœºæœ¬åœ°å†™å…¥å’Œè¯»å–æ•°æ®
---

# æ‰‹æœºæœ¬åœ°å†™å…¥å’Œè¯»å–æ•°æ®

## ç›¸å…³é“¾æ¥

- https://developers.weixin.qq.com/miniprogram/dev/framework/ability/file-system.html

- readFileSyncã€writeFileSyncã€readFileå’ŒwriteFileæ˜¯Node.jsçš„æ–‡ä»¶ç³»ç»Ÿæ¨¡å—(fs)æä¾›çš„ä¸åŒæ–‡ä»¶è¯»å†™æ–¹æ³•
- readFileSync å’Œ writeFileSync æ˜¯åŒæ­¥è¯»å†™æ–‡ä»¶çš„æ–¹æ³•ï¼Œè°ƒç”¨æ—¶ï¼Œä»£ç ä¼šç­‰å¾…æ–‡ä»¶å†™å…¥å®Œæˆåæ‰ç»§ç»­å¾€ä¸‹æ‰§è¡Œ
- readFile å’Œ writeFile æ˜¯å¼‚æ­¥è¯»å†™æ–‡ä»¶çš„æ–¹æ³•ï¼Œè°ƒç”¨æ—¶ï¼Œä»£ç ä¸ä¼šç­‰å¾…æ–‡ä»¶å†™å…¥å®Œæˆï¼Œè€Œæ˜¯ç›´æ¥æ‰§è¡Œåé¢çš„ä»£ç ï¼Œæ–‡ä»¶å†™å…¥å®Œæˆåä¼šæ‰§è¡Œå›è°ƒå‡½æ•°

## ã€åŒæ­¥ã€‘è¯»å–å’Œå†™å…¥

- offLine.js

```js
// å¯¼å…¥æ–‡ä»¶ç³»ç»Ÿç®¡ç†å™¨
const system = wx.getFileSystemManager();

/**
 * åŒæ­¥å†™å…¥æ•°æ®åˆ°æŒ‡å®šçš„æ–‡ä»¶ä¸­
 * @param {string} fileName - æ–‡ä»¶åï¼Œä¸åŒ…æ‹¬æ‰©å±•å
 * @param {*} data - è¦å†™å…¥çš„æ•°æ®ï¼Œä»»æ„ç±»å‹
 */
function write(fileName, data) {
  try {
    system.writeFileSync(
      `${wx.env.USER_DATA_PATH}/${fileName}.json`,
      JSON.stringify(data),
      "utf8"
    );
    console.log('ğŸ“µ ~ ', `${fileName}æœ¬åœ°ç¼“å­˜å†™å…¥æˆåŠŸ`);
    return true;
  } catch (e) {
    console.log('ğŸ“µ ~ ', `${fileName}æœ¬åœ°ç¼“å­˜å†™å…¥å¤±è´¥: ` + e);
    return false;
  }
}

/**
 * åŒæ­¥è¯»å–æŒ‡å®šæ–‡ä»¶çš„å†…å®¹
 * @param {string} fileName - æ–‡ä»¶åï¼Œä¸åŒ…æ‹¬æ‰©å±•å
 */
function read(fileName) {
  try {
    const json = system.readFileSync(
      `${wx.env.USER_DATA_PATH}/${fileName}.json`,
      "utf8"
    );
    console.log('ğŸ“µ ~ ', `${fileName}æœ¬åœ°ç¼“å­˜è¯»å–æˆåŠŸ`);
    return JSON.parse(json);
  } catch (e) {
    console.log('ğŸ“µ ~ ', `${fileName}æœ¬åœ°ç¼“å­˜è¯»å–å¤±è´¥: ` + e);
    return [];
  }
}

const offLine = {
  write,
  read
};
export default offLine;
```

## ã€åŒæ­¥ã€‘å†™å…¥å’Œè¯»å–è°ƒç”¨ç¤ºä¾‹
```js
import offLine from "../../utils/offLine.js";

// åŒæ­¥å†™å…¥è°ƒç”¨ç¤ºä¾‹
const data = [
  { id: 1, name: 'John' },
  { id: 2, name: 'Jane' },
];

const success = offLine.write('exampleFile', data);
if (success) {
  console.log('å†™å…¥æˆåŠŸ');
} else {
  console.log('å†™å…¥å¤±è´¥');
}

// åŒæ­¥è¯»å–è°ƒç”¨ç¤ºä¾‹
const data = offLine.read('exampleFile');
console.log('è¯»å–ç»“æœ:', data);
```

## ã€å¼‚æ­¥ã€‘è¯»å–å’Œå†™å…¥

- offLine.js

```js
// å¯¼å…¥æ–‡ä»¶ç³»ç»Ÿç®¡ç†å™¨
const system = wx.getFileSystemManager();

/**
 * å¼‚æ­¥å†™å…¥æ•°æ®åˆ°æŒ‡å®šçš„æ–‡ä»¶ä¸­ï¼Œå¹¶é€šè¿‡å›è°ƒå‡½æ•°è¿”å›å†™å…¥ç»“æœ
 * @param {string} fileName - æ–‡ä»¶åï¼Œä¸åŒ…æ‹¬æ‰©å±•å
 * @param {*} data - è¦å†™å…¥çš„æ•°æ®ï¼Œä»»æ„ç±»å‹
 * @param {function} callback - å›è°ƒå‡½æ•°ï¼Œæ¥å—å†™å…¥ç»“æœ(true/false)ä½œä¸ºå‚æ•°
 */
function write(fileName, data, callback) {
  system.writeFile({
    filePath: `${wx.env.USER_DATA_PATH}/${fileName}.json`,
    data: JSON.stringify(data),
    encoding: 'utf8',
    success: () => {
      console.log('ğŸ“µ ~ ', `${fileName} æœ¬åœ°ç¼“å­˜å†™å…¥æˆåŠŸ`);
      callback(true);
    },
    fail: (err) => {
      console.log('ğŸ“µ ~ ', `${fileName} æœ¬åœ°ç¼“å­˜å†™å…¥å¤±è´¥ :` + err);
      callback(false);
    }
  });
}

/**
 * å¼‚æ­¥è¯»å–æŒ‡å®šæ–‡ä»¶çš„å†…å®¹ï¼Œå¹¶é€šè¿‡å›è°ƒå‡½æ•°è¿”å›æ•°æ®
 * @param {string} fileName - æ–‡ä»¶åï¼Œä¸åŒ…æ‹¬æ‰©å±•å
 * @param {function} callback - å›è°ƒå‡½æ•°ï¼Œæ¥å—è¯»å–åˆ°çš„æ•°æ®ä½œä¸ºå‚æ•°
 */
function read(fileName, callback) {
  system.readFile({
    filePath: `${wx.env.USER_DATA_PATH}/${fileName}.json`,
    encoding: 'utf8',
    success: (res) => {
      const list = JSON.parse(res.data);
      console.log('ğŸ“µ ~ ', `${fileName} æœ¬åœ°ç¼“å­˜è¯»å–æˆåŠŸ`);
      callback(list);
    },
    fail: (err) => {
      console.log('ğŸ“µ ~ ',`${fileName} æœ¬åœ°ç¼“å­˜è¯»å–å¤±è´¥ :` + err);
      callback([]);
    }
  });
}

const offLine = {
  write,
  read
};
export default offLine;
```

## ã€å¼‚æ­¥ã€‘å†™å…¥å’Œè¯»å–è°ƒç”¨ç¤ºä¾‹
```js
import offLine from "../../utils/offLine.js";

// å¼‚æ­¥å†™å…¥è°ƒç”¨ç¤ºä¾‹
const data = [
  { id: 1, name: 'John' },
  { id: 2, name: 'Jane' },
];

offLine.write('exampleFile', data, (result) => {
    console.log('å†™å…¥:', result);
});

// å¼‚æ­¥è¯»å–è°ƒç”¨ç¤ºä¾‹
offLine.read('ownerLocalFile', (data) => {
    console.log('è¯»å–ç»“æœ:', data);
});
```