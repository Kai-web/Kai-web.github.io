import{_ as s,o as n,c as a,a as l}from"./app.c25d72b6.js";const p="/\u5C0F\u7A0B\u5E8F/app\u5730\u56FE\u79BB\u7EBF\u6709\u7F51\u94FE\u63A5.png",o="/\u5C0F\u7A0B\u5E8F/app\u5730\u56FE\u79BB\u7EBF\u65E0\u7F51\u94FE\u63A5.png",e="/\u5C0F\u7A0B\u5E8F/app\u5B89\u5353\u624B\u673A\u5730\u56FE\u7F13\u5B58.png",c="/\u5C0F\u7A0B\u5E8F/app\u5730\u56FE\u79BB\u7EBF\u6570\u636E\u5E93\u793A\u4F8B.png",h=JSON.parse('{"title":"GIS\u5730\u56FE-\u5730\u56FE\u79BB\u7EBF","description":"","frontmatter":{"title":"GIS\u5730\u56FE-\u5730\u56FE\u79BB\u7EBF"},"headers":[{"level":3,"title":"\u5730\u56FE\u79BB\u7EBF","slug":"\u5730\u56FE\u79BB\u7EBF","link":"#\u5730\u56FE\u79BB\u7EBF","children":[]},{"level":3,"title":"\u6709\u7F51\u65F6\u7F13\u5B58\u74E6\u7247\u5230SQLite\u6570\u636E\u5E93","slug":"\u6709\u7F51\u65F6\u7F13\u5B58\u74E6\u7247\u5230sqlite\u6570\u636E\u5E93","link":"#\u6709\u7F51\u65F6\u7F13\u5B58\u74E6\u7247\u5230sqlite\u6570\u636E\u5E93","children":[]},{"level":3,"title":"\u6709\u7F51\u65F6\u7684\u8BF7\u6C42\u94FE\u63A5","slug":"\u6709\u7F51\u65F6\u7684\u8BF7\u6C42\u94FE\u63A5","link":"#\u6709\u7F51\u65F6\u7684\u8BF7\u6C42\u94FE\u63A5","children":[]},{"level":3,"title":"\u65E0\u7F51\u52A0\u8F7DSQLite\u4E2D\u74E6\u7247","slug":"\u65E0\u7F51\u52A0\u8F7Dsqlite\u4E2D\u74E6\u7247","link":"#\u65E0\u7F51\u52A0\u8F7Dsqlite\u4E2D\u74E6\u7247","children":[]},{"level":3,"title":"\u65E0\u7F51\u65F6\u6A21\u62DF\u7684\u8BF7\u6C42\u94FE\u63A5","slug":"\u65E0\u7F51\u65F6\u6A21\u62DF\u7684\u8BF7\u6C42\u94FE\u63A5","link":"#\u65E0\u7F51\u65F6\u6A21\u62DF\u7684\u8BF7\u6C42\u94FE\u63A5","children":[]},{"level":3,"title":"\u6570\u636E\u5E93\u4E2D\u7684\u7F13\u5B58\u6570\u636E","slug":"\u6570\u636E\u5E93\u4E2D\u7684\u7F13\u5B58\u6570\u636E","link":"#\u6570\u636E\u5E93\u4E2D\u7684\u7F13\u5B58\u6570\u636E","children":[]}],"relativePath":"App-\u5C0F\u7A0B\u5E8F/APP\u5E94\u7528(\u516B)\uFF1AGIS\u5730\u56FE-\u79BB\u7EBF.md"}'),t={name:"App-\u5C0F\u7A0B\u5E8F/APP\u5E94\u7528(\u516B)\uFF1AGIS\u5730\u56FE-\u79BB\u7EBF.md"},r=l(`<h1 id="gis\u5730\u56FE-\u5730\u56FE\u79BB\u7EBF" tabindex="-1">GIS\u5730\u56FE-\u5730\u56FE\u79BB\u7EBF <a class="header-anchor" href="#gis\u5730\u56FE-\u5730\u56FE\u79BB\u7EBF" aria-hidden="true">#</a></h1><h3 id="\u5730\u56FE\u79BB\u7EBF" tabindex="-1">\u5730\u56FE\u79BB\u7EBF <a class="header-anchor" href="#\u5730\u56FE\u79BB\u7EBF" aria-hidden="true">#</a></h3><ul><li><p>\u5730\u56FE\u79BB\u7EBF\u53EF\u4EE5\u91C7\u7528SQLite\uFF08indexDB,\u74E6\u7247\u4EE5\u56FE\u7247\u65B9\u5F0F\u5B58\u5165\u624B\u673A\u7B49\u5176\u4ED6\u65B9\u5F0F\u4E5F\u53EF\u5B9E\u73B0\uFF09\u3002\u5B9E\u73B0\u5730\u56FE\u79BB\u7EBF\u7684\u91CD\u8981\u65B9\u5F0F\u4E3Amapbox\u7684 <a href="https://docs.mapbox.com/mapbox-gl-js/api/properties/#requestparameters" target="_blank" rel="noreferrer">transformRequest</a>\uFF0C\u5B83\u53EF\u4EE5\u5728\u5730\u56FE\u8BF7\u6C42\u5916\u90E8URL\u4E4B\u524D\u8FD0\u884C\u56DE\u8C03\u3002\u56DE\u8C03\u53EF\u7528\u4E8E\u62E6\u622A\u4FEE\u6539url\u3002\u65E0\u7F51\u65F6\u6211\u4EEC\u53EF\u4EE5\u901A\u8FC7transformRequest\u5411\u6846\u67B6\u53D1\u9001\u6A21\u62DF\u8BF7\u6C42\u3002</p></li><li><p>\u4E0B\u8F7D\u74E6\u7247\u6211\u8FD9\u91CC\u4F7F\u7528\u7684\u662Ffetch\u8BF7\u6C42\uFF0C\u539F\u56E0\u662Fdemo\u91CC\u662F\u4E3A\u4E86\u6F14\u793A\u5730\u56FE\u7F13\u5B58\uFF0C\u53EA\u8981\u662F\u67E5\u770B\u8FC7\u7684\u533A\u57DF\u5C31\u4F1A\u81EA\u52A8\u7F13\u5B58\uFF0C\u540E\u7EED\u53EF\u80FD\u4F1A\u9700\u8981\u50CF\u5965\u7EF4\u5730\u56FE\u4E00\u6837\uFF0C\u6709\u6846\u9009\u67D0\u7247\u533A\u57DF\u7F13\u5B58\u79BB\u7EBF\u74E6\u7247\u7684\u9700\u6C42\uFF0C\u90A3\u4E48\u4E5F\u53EF\u4EE5\u5229\u7528\u6846\u9009\u533A\u57DF\u7684zxy\u6765fetch\u8BF7\u6C42\u5B9E\u73B0\u7F13\u5B58\u3002</p></li></ul><h3 id="\u6709\u7F51\u65F6\u7F13\u5B58\u74E6\u7247\u5230sqlite\u6570\u636E\u5E93" tabindex="-1">\u6709\u7F51\u65F6\u7F13\u5B58\u74E6\u7247\u5230SQLite\u6570\u636E\u5E93 <a class="header-anchor" href="#\u6709\u7F51\u65F6\u7F13\u5B58\u74E6\u7247\u5230sqlite\u6570\u636E\u5E93" aria-hidden="true">#</a></h3><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">/**</span></span>
<span class="line"><span style="color:#676E95;">   * \u8BBE\u7F6E\u74E6\u7247\u8BF7\u6C42\u76D1\u542C</span></span>
<span class="line"><span style="color:#676E95;">	 * </span></span>
<span class="line"><span style="color:#676E95;">	 * transformRequest\u4E5F\u53EF\u5B9E\u73B0\u8BF7\u6C42\u76D1\u542C\uFF0C\u8FD9\u91CC\u4E3A\u4E86\u4E0D\u5F71\u54CD\u6B63\u5E38\u7684\u74E6\u7247\u52A0\u8F7D\u6D41\u7A0B\uFF0C\u540C\u65F6\u53EF\u4EE5\u5F02\u6B65\u5730\u8FDB\u884C\u7F13\u5B58\u64CD\u4F5C\uFF0C\u4F7F\u7528\u4E86Mapbox\u7684\u4E8B\u4EF6\u76D1\u542C\u4E8B\u4EF6</span></span>
<span class="line"><span style="color:#676E95;">	 * \u76D1\u542C\u4E24\u4E2A\u4E8B\u4EF6\uFF1A1\u3001sourcedata\uFF1A\u5F53\u5730\u56FE\u6E90\u6570\u636E\u53D1\u751F\u53D8\u5316\u65F6\u89E6\u53D1  2\u3001data\uFF1A\u5F53\u5730\u56FE\u6570\u636E\u52A0\u8F7D\u65F6\u89E6\u53D1\u3002\u771F\u5B9E\u4E1A\u52A1\u91CC\u9762\u6211\u4EEC\u8981\u7F13\u5B58\u4E0D\u6B62\u5730\u56FE\u74E6\u7247\u8FD8\u6709\u5730\u56FE\u4E0A\u7684\u56FE\u5C42\u6570\u636E\uFF0C\u7B49\u7B49\u5176\u4ED6\u6570\u636E\uFF0C</span></span>
<span class="line"><span style="color:#676E95;">	 * </span></span>
<span class="line"><span style="color:#676E95;">   * </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">param</span><span style="color:#676E95;"> </span><span style="color:#89DDFF;">{</span><span style="color:#FFCB6B;">string[]</span><span style="color:#89DDFF;">}</span><span style="color:#676E95;"> </span><span style="color:#A6ACCD;">sources</span><span style="color:#676E95;"> \u9700\u8981\u7F13\u5B58\u7684\u74E6\u7247\u6E90</span></span>
<span class="line"><span style="color:#676E95;">   */</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">setupTileListener</span><span style="color:#A6ACCD;">(sources) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">handleTileEvent</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">sourceId</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">sources</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">includes</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">sourceId</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">tile</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">source</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">map</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getSource</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">sourceId</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">source</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">source</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">tiles</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// \u83B7\u53D6\u5230\u6807\u51C6\u5316\u7684\u74E6\u7247\u5750\u6807\uFF08z/x/y\uFF09</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">coords</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">tile</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">tileID</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">canonical</span><span style="color:#F07178;">\v          </span><span style="color:#676E95;">// TILEMATRIX={z} \u5BF9\u5E94\u7F29\u653E\u7EA7\u522B</span></span>
<span class="line"><span style="color:#89DDFF;">			</span><span style="color:#676E95;">// TILECOL={x} \u5BF9\u5E94x\u5750\u6807</span></span>
<span class="line"><span style="color:#89DDFF;">			</span><span style="color:#676E95;">// TILEROW={y} \u5BF9\u5E94y\u5750\u6807</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">url</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">source</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">tiles</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">replace</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">{z}</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">coords</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">z</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">replace</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">{x}</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">coords</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">x</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">replace</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">{y}</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">coords</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">y</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">			</span><span style="color:#676E95;">// console.log(&#39;\u{1F680} ~ [\u74E6\u7247\u8BF7\u6C42:]&#39;, url, &#39;\u{1F680} ~ [source:]&#39;, e.sourceId)</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#82AAFF;">downloadAndCacheTile</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">url</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">coords</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">z</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">coords</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">x</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">coords</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">y</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">sourceId</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">map</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">on</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">sourcedata</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">handleTileEvent</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">map</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">on</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">data</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">handleTileEvent</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">\v</span><span style="color:#676E95;">/**</span></span>
<span class="line"><span style="color:#676E95;"> * \u4E0B\u8F7D\u5E76\u7F13\u5B58\u74E6\u7247</span></span>
<span class="line"><span style="color:#676E95;"> * </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">param</span><span style="color:#676E95;"> </span><span style="color:#89DDFF;">{</span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">}</span><span style="color:#676E95;"> </span><span style="color:#A6ACCD;">url</span><span style="color:#676E95;"> \u74E6\u7247URL</span></span>
<span class="line"><span style="color:#676E95;"> * </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">param</span><span style="color:#676E95;"> </span><span style="color:#89DDFF;">{</span><span style="color:#FFCB6B;">number</span><span style="color:#89DDFF;">}</span><span style="color:#676E95;"> </span><span style="color:#A6ACCD;">z</span><span style="color:#676E95;"> \u7F29\u653E\u7EA7\u522B</span></span>
<span class="line"><span style="color:#676E95;"> * </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">param</span><span style="color:#676E95;"> </span><span style="color:#89DDFF;">{</span><span style="color:#FFCB6B;">number</span><span style="color:#89DDFF;">}</span><span style="color:#676E95;"> </span><span style="color:#A6ACCD;">x</span><span style="color:#676E95;"> X\u5750\u6807</span></span>
<span class="line"><span style="color:#676E95;"> * </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">param</span><span style="color:#676E95;"> </span><span style="color:#89DDFF;">{</span><span style="color:#FFCB6B;">number</span><span style="color:#89DDFF;">}</span><span style="color:#676E95;"> </span><span style="color:#A6ACCD;">y</span><span style="color:#676E95;"> Y\u5750\u6807</span></span>
<span class="line"><span style="color:#676E95;"> * </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">param</span><span style="color:#676E95;"> </span><span style="color:#89DDFF;">{</span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">}</span><span style="color:#676E95;"> </span><span style="color:#A6ACCD;">source</span><span style="color:#676E95;"> \u74E6\u7247\u6E90</span></span>
<span class="line"><span style="color:#676E95;"> */</span></span>
<span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> downloadAndCacheTile </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">url</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">z</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">x</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">y</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">source</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">try</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u5148\u68C0\u67E5\u74E6\u7247\u662F\u5426\u5DF2\u5B58\u5728</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">exists</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">checkTileExists</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">z</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">x</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">y</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">source</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">exists</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// console.log(&#39;\u{1F680} ~ [\u74E6\u7247\u5DF2\u5B58\u5728\uFF0C\u8DF3\u8FC7\u4E0B\u8F7D:]&#39;, \`z=\${z}, x=\${x}, y=\${y}, source=\${source}\`)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// console.log(&#39;\u{1F680} ~ [\u5F00\u59CB\u4E0B\u8F7D\u74E6\u7247:]&#39;, url)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">response</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">fetch</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">url</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">response</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ok</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">throw</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Error</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">HTTP error! status: </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">response</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">status</span><span style="color:#89DDFF;">}\`</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">blob</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">response</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">blob</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// console.log(&#39;\u{1F680} ~ [\u83B7\u53D6\u5230\u7684\u74E6\u7247\u5927\u5C0F:]&#39;, blob.size, &#39;bytes&#39;)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">base64Data</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">reject</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">reader</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">FileReader</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">reader</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onloadend</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">reader</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">reader</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">onerror</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">reject</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">reader</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">readAsDataURL</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">blob</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// console.log(&#39;\u{1F680} ~ [Base64\u6570\u636E\u957F\u5EA6:]&#39;, base64Data.length)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">saveTile</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">url</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">z</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">x</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">y</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">base64Data</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">source</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">base64Data</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">catch</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">error</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">\u{1F680} ~ [\u4E0B\u8F7D\u74E6\u7247\u5931\u8D25:]</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">error</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="\u6709\u7F51\u65F6\u7684\u8BF7\u6C42\u94FE\u63A5" tabindex="-1">\u6709\u7F51\u65F6\u7684\u8BF7\u6C42\u94FE\u63A5 <a class="header-anchor" href="#\u6709\u7F51\u65F6\u7684\u8BF7\u6C42\u94FE\u63A5" aria-hidden="true">#</a></h3><img src="`+p+`" width="600" height="600"><h3 id="\u65E0\u7F51\u52A0\u8F7Dsqlite\u4E2D\u74E6\u7247" tabindex="-1">\u65E0\u7F51\u52A0\u8F7DSQLite\u4E2D\u74E6\u7247 <a class="header-anchor" href="#\u65E0\u7F51\u52A0\u8F7Dsqlite\u4E2D\u74E6\u7247" aria-hidden="true">#</a></h3><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">async </span><span style="color:#82AAFF;">createOfflineMap</span><span style="color:#A6ACCD;">(container</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> source</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> options </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u9996\u5148\u4ECESQLite\u7F13\u5B58\u83B7\u53D6\u6240\u6709\u74E6\u7247</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">tiles</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">getAllTiles</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">source</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">tileData</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">formatTileData</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">tiles</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u4F7F\u7528\u7279\u6B8A\u7684\u74E6\u7247\u6E90\u914D\u7F6E</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">defaultOptions</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    style</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      sources</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">offline-tiles</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          type</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">raster</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">           </span><span style="color:#676E95;">// \u5173\u952E\u70B91\uFF1A\u4F7F\u7528\u7279\u6B8A\u683C\u5F0F\u7684\u865A\u62DFURL\uFF08\u524D\u7F00\u53EF\u4EE5\u968F\u610F\u5B9A\u4E49\uFF0C\u6211\u4EEC\u53EA\u9700\u8981\u548CtransformRequest\u4E2D\u4E00\u6837\u5C31\u884C\uFF09</span></span>
<span class="line"><span style="color:#F07178;">          tiles</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">data:image/png;base64,{z}/{x}/{y}</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span></span>
<span class="line"><span style="color:#F07178;">          ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">          tileSize</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">256</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u901A\u8FC7 transformRequest \u62E6\u622A\u548C\u5904\u7406\u8FD9\u4E2A\u865A\u62DFURL</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">transformRequest</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">url</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">resourceType</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u5173\u952E\u70B92\uFF1A\u8BC6\u522B\u865A\u62DFURL\u8BF7\u6C42</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">resourceType</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Tile</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">url</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">includes</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">data:image/png;base64,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u5173\u952E\u70B93\uFF1A\u4ECE\u865A\u62DFURL\u4E2D\u63D0\u53D6\u74E6\u7247\u5750\u6807</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">parts</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">url</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">replace</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">data:image/png;base64,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">split</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">parts</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// \u5173\u952E\u70B94\uFF1A\u8FD4\u56DE\u5B9E\u9645\u7684\u7F13\u5B58\u74E6\u7247\u6570\u636E\uFF0C\u6846\u67B6\u4F1A\u81EA\u5DF1\u5904\u7406\u52A0\u8F7D\u74E6\u7247</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">tileData</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;">]) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> url</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">tileData</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> cancel</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">url</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="\u65E0\u7F51\u65F6\u6A21\u62DF\u7684\u8BF7\u6C42\u94FE\u63A5" tabindex="-1">\u65E0\u7F51\u65F6\u6A21\u62DF\u7684\u8BF7\u6C42\u94FE\u63A5 <a class="header-anchor" href="#\u65E0\u7F51\u65F6\u6A21\u62DF\u7684\u8BF7\u6C42\u94FE\u63A5" aria-hidden="true">#</a></h3><img src="`+o+'" width="600" height="600"><h3 id="\u6570\u636E\u5E93\u4E2D\u7684\u7F13\u5B58\u6570\u636E" tabindex="-1">\u6570\u636E\u5E93\u4E2D\u7684\u7F13\u5B58\u6570\u636E <a class="header-anchor" href="#\u6570\u636E\u5E93\u4E2D\u7684\u7F13\u5B58\u6570\u636E" aria-hidden="true">#</a></h3><img src="'+e+'" width="200" height="200"><ul><li>\u901A\u8FC7\u6570\u636E\u5E93\u5DE5\u5177\u67E5\u770B\u8868\u7ED3\u6784</li></ul><img src="'+c+'" width="600" height="600">',15),F=[r];function y(D,A,C,i,d,E){return n(),a("div",null,F)}const m=s(t,[["render",y]]);export{h as __pageData,m as default};
